"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["4089"],{57577:function(e,t,i){i.d(t,{Z:()=>eu});var n=i(7409),r=i(99282),o=i(16584),a=i(30396),l=i(94184),s=i.n(l),u=i(14293),d=i.n(u),c=i(24840),p=i(80569),_=i.n(p),h=i(31131),m=i(99869),b=i(67358),v=i(12561),f=i(59154),Z=i(79138),g=i(37632),C=i(4473),y=i(39535),E=i(75697),N=i(58474),k=i(95441),S=i(68833),x=i(15771),A=i(36500),B=i(84747),P=i(63651),w=i(47929);function M(e){let{pub:t,user:i}=e,{iString:n}=(0,k.M1)(),[r,l]=(0,a.eJ)(!1),s=(0,P.SVA)(t),u={utm_source:w.b3.navbar,utm_medium:w.lP.web,r:(null==i?void 0:i.id)?i.id.toString(36):null},d=(0,P.n1t)(s,u),c=async()=>{(0,S.j)(S.FP.PUBLICATION_SHARE_BUTTON_CLICKED)},p=(0,o.tZ)(x.hU,{"aria-label":n("Share Publication"),priority:"tertiary",children:(0,o.tZ)(h.Z,{size:20})});return(0,o.BX)(o.HY,{children:[(0,o.BX)(B.M,{trigger:p,onOpen:c,layerOptions:{placement:"bottom-end",preferX:"left"},className:"dropdownMenu-zWNckK",maxHeight:"fit-content",children:[(0,o.tZ)(B.u,{leading:(0,o.tZ)(m.Z,{}),onClick:()=>{(0,E.Ui)({shareUrl:d,pub:t,utm_campaign:w.VX.navbar})},children:n("Copy link")}),(0,o.tZ)(B.u,{leading:(0,o.tZ)(b.Z,{}),onClick:()=>{(0,E.WZ)({shareUrl:d,shareName:"Subscribe to ".concat(t.name),pub:t,utm_campaign:w.VX.navbar})},children:n("Send as email")}),(0,o.tZ)(B.u,{leading:(0,o.tZ)(v.Z,{}),onClick:()=>{(0,S.j)(S.FP.SHARE_PUBLICATION_MODAL_OPENED),l(!0)},children:n("Get shareable images")}),(0,o.BX)(A.xw,{children:[(0,o.tZ)(B.u,{leading:(0,o.tZ)(C.Z,{}),onClick:()=>{(0,E.BZ)({shareUrl:d,pub:t,utm_campaign:w.VX.navbar})},children:n("Share to Notes")}),(0,o.tZ)(B.u,{leading:(0,o.tZ)(Z.Z,{}),onClick:()=>{(0,E.Po)({shareUrl:d,pub:t,utm_campaign:w.VX.navbar})},children:n("Share to Facebook")}),(0,o.tZ)(B.u,{leading:(0,o.tZ)(g.Z,{}),onClick:()=>{(0,E.lc)({shareUrl:d,pub:t,utm_campaign:w.VX.navbar})},children:n("Share to Linkedin")}),(0,o.tZ)(B.u,{leading:(0,o.tZ)(f.Z,{}),onClick:()=>{(0,E.bI)({shareUrl:d,shareName:t.name,pub:t,utm_campaign:w.VX.navbar})},children:n("Share to Bluesky")}),(0,o.tZ)(B.u,{leading:(0,o.tZ)(y.Z,{}),onClick:()=>{(0,E.Wn)({shareUrl:d,shareName:t.name,pub:t,utm_campaign:w.VX.navbar})},children:n("Share to X")})]})]}),(0,o.tZ)(N.iL,{pub:t,isOpen:r,setOpen:l,item:{type:"pub_shareable_image"},width:718})]})}var I=i(33804),U=i(347),z=i(12757),R=i(57391),X=i(36848),D=i(39648),F=i(56629),T=i(40647),L=i(65205),O=i(34552),V=i(98914),j=i(98422),H=i(80026),K=i(19081),W=i(38841),q=i(78096),G=i(70379),$=i(87077),Q=i(91684),Y=i(74583),J=i(98012),ee=i(24791),et=i(6070),ei=i(67914),en=i(60308),er=i(26111),eo=i(84864);let ea=e=>{let{pub:t,dashboardPubs:i}=e,{isMobile:n}=(0,j.v9)(),{iString:r}=(0,k.M1)();return(0,o.tZ)(q.gd,{priority:"secondary",size:n?"sm":"md",menuItems:i.map(e=>{let{logo_url:i,name:n,subdomain:r}=e;return(0,o.tZ)(B.u,{href:(0,en.c0Q)(r,{params:{utm_source:w.b3.substack,utm_content:w.fZ.dashboardPubSwitcher}}),leading:(0,o.tZ)(W.wk,{size:24,radius:"xs",logoUrl:i}),priority:t.subdomain===r?"selected":"primary",children:n})}),href:(0,P.QK7)(t,{addBase:!0}),localNavigation:!1,"data-testid":"menu-dashboard-button",children:r("Dashboard")})};function el(){let{iString:e}=(0,k.M1)(),t=(0,D.O4)();return(0,o.tZ)($.u,{text:e("Search"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:$.$$},children:(0,o.tZ)(H.hU,{priority:"tertiary",onClick:()=>t.open(),children:(0,o.tZ)(c.Z,{size:20})})})}let es=e=>{let{dashboardPubs:t,pub:i}=e,{iString:n}=(0,k.M1)(),{isMobile:r}=(0,j.v9)();return t.length>1?(0,o.tZ)(ea,{pub:i,dashboardPubs:t}):(0,o.tZ)(H.zx,{size:r?"sm":"md",priority:"secondary",href:(0,P.QK7)(i,{addBase:!0}),"data-testid":"menu-dashboard-button",localNavigation:!1,children:n("Dashboard")})},eu=e=>{let{className:t,fixedTooltip:i=!0,freeSignup:l,freeSignupEmail:u,hideCta:c,hideNotifications:p,hideChat:h,hideSearch:m,hideShare:b,hideUserIndicator:v,hide_subscribe_cta:f,isAccountContext:Z=!1,isMeetingsActive:g,hasViralGiftsCount:C,isPublishContext:y,pub:E,showCustomerSupportModeModal:N,user:x}=e,{iString:A,language:B}=(0,k.M1)(),{isMobile:D}=(0,j.v9)(),{getSettingFor:W}=(0,F.So)(),q=(0,R.jc)(),[$,ea]=(0,a.eJ)(!1),[eu,ed]=(0,a.eJ)(!1),ec=(0,G.pm)(),{enableCustomerServiceMode:ep,disableCustomerServiceMode:e_,modalElement:eh}=(0,O.Vc)({showCustomerSupportModeModal:N}),em=async()=>{ea(!0);try{await _().post("/api/v1/subscription/reactivate").send({}),ed(!0),ec.popToast(e=>(0,o.tZ)(G.FN,(0,r._)((0,n._)({},e),{text:A("Your subscription has been renewed!")})))}catch(e){console.error("Failed to set to renew:",e),alert((0,V.zx)(e))}finally{ea(!1)}},eb=y||Z?I.w:U.h;return(0,o.tZ)(K.gq,{alignItems:"center",gap:D?4:8,className:s()("navbar-buttons",t),justifyContent:"end",children:(0,o.BX)(eb,{children:[(0,o.tZ)(T.QA.Consumer,{children:e=>(0,o.tZ)(X.RD.Consumer,{children:t=>(0,o.BX)(o.HY,{children:[!D&&!x&&(0,o.BX)(K.gq,{gap:4,children:[!m&&(0,o.tZ)(el,{}),!b&&(0,o.tZ)(M,{pub:E,user:null!=x?x:void 0})]}),!D&&x&&(0,o.BX)(K.gq,{gap:4,children:[!m&&(0,o.tZ)(el,{}),h?!b&&(0,o.tZ)(M,{pub:E,user:x}):(0,o.tZ)(Q.b,{}),!p&&(0,o.tZ)(Y.f,{canShowAlerts:!E||y})]}),!c&&function(e){var t,i,n,r,a,l,s,u,c,p,h;let{user:m,pub:b,freeSignup:v,freeSignupEmail:f,hide_subscribe_cta:Z,isPublishContext:g,isMeetingsActive:C,hasViralGiftsCount:y,siteConfigContext:E,getSettingFor:N,experimentApi:{exposeExperiment:k,getExperimentVariant:x},renewing:A,renewed:B,setToRenew:M,language:I,isMobile:U}=e,{iString:z,iPlural:R}=I18N.i(I);b.invite_only&&!((null==m?void 0:m.subscription_id)||(null==m?void 0:m.is_free_subscribed))&&(Z=!0);let X=null==m?void 0:m.is_contributor,D=(null==m?void 0:m.is_subscribed)||X,F=(null==m?void 0:m.is_free_subscribed)||v,T=ee.oH(b)&&D&&["gift","comp"].includes(null!==(r=m.subscription_type)&&void 0!==r?r:"")&&!(0,ei.B9)({pub:b,subscriptionType:null==m?void 0:m.subscription_type})&&(0,J.Z)(m.subscription_expiry).subtract(30,"days").isBeforeNow(),O=ee.oH(b)&&m&&ee.po(m)&&m.comp_expired_recently,j=(null==m?void 0:m.is_free_subscribed)&&(null==m?void 0:m.is_paused),K=(null==m?void 0:m.subscription_type)==="ios_app";if(X){let e=(null==m?void 0:m.dashboard_pubs)||[];return g&&1===e.length?[]:(0,o.tZ)(es,{dashboardPubs:e,pub:b})}if(j)return(0,o.tZ)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:()=>{(0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"unpause-subscription"}),(0,V.uX)((0,en.BhD)(b,{addBase:!0}),{local_navigation:!1})},children:z("Unpause my subscription")});if(T||O){if(!Z)return(0,o.BX)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:()=>{var e;(0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"continue-support"}),(0,V.uX)((0,en.W1P)(b,{utm_source:w.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,er.x)("referring_pub_ids"),addBase:!0,selectedPlanId:T&&(null==m?void 0:m.is_founding)&&b.plans?null===(e=b.plans.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===e?void 0:e.id:null}),{local_navigation:!1})},children:[(0,o.tZ)("span",{className:"mobile-only",children:z("Subscribe")}),(0,o.tZ)("span",{className:"desktop-only",children:z("Continue your support")})]})}else if(ee.oH(b)&&F&&!D&&!["thebulwark"].includes(b.subdomain)){if(!Z)return(0,o.tZ)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:()=>{(0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"upgrade-subscription"}),(0,V.uX)((0,en.W1P)(b,{utm_source:w.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,er.x)("referring_pub_ids"),addBase:!0}),{local_navigation:!1})},children:(0,eo.getSubscribeText)(b,{isFreeSubscribed:!0,isMobile:(0,V.K1)(),language:I})})}else if(ee.oH(b)?D:F||D){if(b.invite_only&&D&&!d()(m.invites)&&m.invites<b.subscriber_invites)return(0,o.tZ)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:()=>{(0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"invite"}),(0,V.uX)((0,en.UzE)(b),{local_navigation:!1})},children:(0,o.tZ)("span",{children:R("1 invite left","%1 invites left",b.subscriber_invites-m.invites)})});if(ee.oH(b)&&C&&E&&!E.getConfigFor("hide_book_a_meeting_button"))return(0,o.BX)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:()=>{(0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"book-meeting"}),(0,V.uX)((0,P.szv)(b,{params:{source:"navbar-cta"},referrer:"undefined"!=typeof window?window.location.href:void 0}),{local_navigation:!1})},children:[(0,o.tZ)("span",{className:"mobile-only",children:z("Book meeting")}),(0,o.tZ)("span",{className:"desktop-only",children:z("Book a meeting")})]});else if(ee.oH(b)&&m&&m.is_subscribed&&!K&&m.subscription_unsubscribed_at&&!["gift","comp"].includes(null!==(a=m.subscription_type)&&void 0!==a?a:""))return(0,o.BX)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:()=>{(0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"renew"}),M()},disabled:A||B,style:{visibility:B?"hidden":"visible"},children:[(0,o.tZ)("span",{className:"mobile-only",children:z("Renew")}),(0,o.tZ)("span",{className:"desktop-only",children:z("Renew subscription")})]})}else if(!Z){let e=null===(u=(0,er.x)("referring_pub_ids"))||void 0===u?void 0:null===(s=u.split)||void 0===s?void 0:null===(l=s.call(u,","))||void 0===l?void 0:l[0],t=null===(h=(0,er.x)("referring_pub_ids"))||void 0===h?void 0:null===(p=h.split)||void 0===p?void 0:null===(c=p.call(h,","))||void 0===c?void 0:c.slice(1);return(0,o.tZ)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:async()=>{let i=m&&!m.is_magic&&m.email||f;if((0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"free-subscription",homepage_type:b.homepage_type}),i){let n;try{n=(await _().post("/api/v1/free").send({source:"menu",email:i,first_url:L.xY,first_referrer:L.ip,current_url:L.UE,current_referrer:L.xU,first_session_url:L.ac,first_session_referrer:L.qR,referring_pub_id:e,additional_referring_pub_ids:t})).body.referral_token,(0,S.IU)()}catch(e){(0,S.j)(S.FP.FREE_SIGNUP_FAILED,{reason:e.message,source:"menu"})}window.location.href=(0,en.W1P)(b,{utm_source:w.b3.menu,simple:!0,next:document.location.href,skip_redirect_check:!0,just_signed_up:!0,addBase:!0,referral_token:n})}else window.location.href=(0,en.W1P)(b,{utm_source:w.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,er.x)("referring_pub_ids"),addBase:!0})},children:(0,eo.getSubscribeText)(b,{isFreeSubscribed:F,isMobile:(0,V.K1)(),language:I})})}if(ee.oH(b)&&m&&m.is_subscribed&&y){let e=(0,P.xdn)({pub:b,params:{utm_source:w.b3.menu}}),t=x("viral_gift_nav_bar_cta");if(k("viral_gift_nav_bar_cta"),["treatment_send","treatment_left"].includes(null!=t?t:"control")){let i="treatment_send"===t?z(y>1?"Send free gifts":"Send free gift"):R("1 gift left","%1 gifts left",y);return(0,o.tZ)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:()=>{(0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"send-viral-gift"}),(0,V.uX)(e,{local_navigation:!1})},children:i})}}if(ee.oH(b)&&m&&!m.is_founding&&!K&&(0,J.Z)(m.subscription_first_payment_at).isBefore((0,J.Z)().subtract(48,"hours"))&&((0,et.VL)({pub:b})||"pinespayments"===b.subdomain||(null==b?void 0:null===(n=b.plans)||void 0===n?void 0:null===(i=n.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===i?void 0:null===(t=i.metadata)||void 0===t?void 0:t.short_description)==="Founding Member")){let e=(0,P.yRy)({pub:b,user:m,params:{utm_source:w.b3.menu,next:document.location.href}});return(0,o.BX)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:()=>{(0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"founding-upgrade"}),(0,V.uX)(e,{local_navigation:!1})},children:[(0,o.tZ)("span",{className:"mobile-only",children:z("Upgrade")}),(0,o.tZ)("span",{className:"desktop-only",children:z("Upgrade to founding")})]})}return"disabled"===b.payments_state&&!b.invite_only&&N("payment_pledges_enabled")&&F&&!(null==m?void 0:m.is_pledged)?(0,o.tZ)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:()=>{(0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"pledge-subscription"}),(0,V.uX)((0,en.W1P)(b,{utm_source:w.b3.menu,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:z("Pledge your support")}):ee.oH(b)&&!b.invite_only?(0,o.BX)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:()=>{(0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"gift-subscription"}),(0,V.uX)((0,et.HD)({pub:b})&&m&&(null==E?void 0:E.getConfigFor("enable_founding_gifts"))?(0,et.Iv)({user:m}):(0,en.W1P)(b,{utm_source:w.b3.menu,gift:!0,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:[(0,o.tZ)("span",{className:"mobile-only",children:z("Give gift")}),(0,o.tZ)("span",{className:"desktop-only",children:z("Gift a subscription")})]}):!b.is_on_substack||(null==m?void 0:m.has_publication)?null:(0,o.tZ)(H.zx,{"data-testid":"noncontributor-cta-button",size:U?"sm":"md",onClick:()=>{(0,S.j)(S.FP.NAV_BAR_CTA_CLICKED,{type:"start-publishing"}),(0,V.uX)((0,en._HV)({utm_source:w.b3.menu}),{local_navigation:!1})},children:z("Start publishing")})}({pub:E,user:x,freeSignup:l,freeSignupEmail:u,hide_subscribe_cta:f,viralGiftsConfig:E.viralGiftsConfig,isPublishContext:y,localeContext:t,siteConfigContext:e,isMeetingsActive:g,hasViralGiftsCount:C,getSettingFor:W,experimentApi:q,renewing:$,renewed:eu,setToRenew:em,language:B,isMobile:D}),!v&&(0,o.tZ)(z.Co,{pub:E,user:x,enableCustomerServiceMode:ep,disableCustomerServiceMode:e_,fixedTooltip:i})]})})}),eh]})})}},12757:function(e,t,i){i.d(t,{Co:()=>T});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(94184),s=i.n(l),u=i(66120),d=i(24840),c=i(43061),p=i(84488),_=i(98661),h=i(86374),m=i(83320),b=i(87698),v=i(89320),f=i(9997),Z=i(78327);let g=(0,i(6400).createContext)(!1);var C=i(95441),y=i(36518),E=i(68833),N=i(43251),k=i(98422),S=i(94874),x=i(17540),A=i(15771),B=i(19081),P=i(36500),w=i(84747),M=i(58175),I=i(60308),U=i(6911),z=i(63651),R=i(47929),X=i(75983);let D=R.b3.userMenu,F="https://support.substack.com/hc/en-us/?utm_source=".concat(D);function T(e){var{user:t,pub:i}=e,l=(0,o._)(e,["user","pub"]);let{iString:u}=(0,C.M1)(),d=(0,_.useContext)(g),{isMobile:c}=(0,k.v9)();return(0,a.tZ)(a.HY,{children:t?(0,a.tZ)(L,(0,r._)((0,n._)({},l),{user:t,pub:i})):(0,a.tZ)(A.zx,{href:(0,I.uXE)({for_pub:null==i?void 0:i.subdomain}),priority:"tertiary",size:c?"sm":"md",className:s()({"force-desktop":d}),native:!0,children:u("Sign in")})})}function L(e){var{user:t}=e,i=(0,o._)(e,["user"]);let{isMobile:l}=(0,k.v9)(),s=l||!t.photo_url?(0,a.tZ)(A.hU,{priority:"tertiary",size:"sm",children:(0,a.tZ)(u.Z,{size:20})}):(0,a.tZ)(O,{user:t});return(0,a.tZ)(V,(0,r._)((0,n._)({},i),{user:t,trigger:s}))}let O=(0,_.forwardRef)((e,t)=>{var{user:i}=e,l=(0,o._)(e,["user"]);let{isMobile:s}=(0,k.v9)();return(0,a.tZ)(A.kG,(0,r._)((0,n._)({},l),{resetCss:!0,position:"relative",className:X.Z.avatarButton,showFocus:!0,animate:!0,radius:"full",ref:t,children:(0,a.tZ)(x.Ct,{priority:"secondary",theme:"default",fillIcon:!0,placement:"bottom-right",content:(0,a.tZ)(h.Z,{size:14}),children:(0,a.tZ)(S.qE,{user:i,size:s?32:40,"aria-hidden":!0})})}))});function V(e){let{trigger:t,user:i,pub:n,enableCustomerServiceMode:r,disableCustomerServiceMode:o,freeSignup:l}=e,{iString:s}=(0,C.M1)(),{activityUnreadCount:u}=(0,y.lR)(),c=e=>()=>{(0,E.j)(e)};return(0,a.BX)(w.M,{trigger:t,onOpen:()=>(0,E.j)(E.FP.USER_MENU_OPENED),onClose:()=>(0,E.j)(E.FP.USER_MENU_DISMISSED),className:X.Z.dropdown,ariaLabel:s("More options"),children:[(0,a.tZ)(j,{user:i}),(0,a.BX)(P.xw,{children:[(0,a.tZ)(w.u,{href:(0,I.E2n)({urlParams:{utm_source:D}}),onClick:c(E.FP.USER_MENU_FEED_CLICKED),leading:(0,a.tZ)(B.hs,{children:(0,a.tZ)(v.Z,{size:20})}),native:!0,children:s("Home")}),(0,a.tZ)(w.u,{href:(0,I.HMK)({utm_source:D}),onClick:c(E.FP.USER_MENU_READER_CLICKED),leading:(0,a.tZ)(B.hs,{children:(0,a.tZ)(f.Z,{size:20})}),native:!0,children:s("Subscriptions")}),(0,a.tZ)(w.u,{href:(0,z.Cnj)(),onClick:c(E.FP.USER_MENU_CHAT_CLICKED),leading:(0,a.tZ)(B.hs,{children:(0,a.tZ)(b.Z,{size:20})}),native:!0,children:s("Chat")}),(0,a.tZ)(w.u,{href:(0,I.Fu$)({utm_source:D}),onClick:c(E.FP.USER_MENU_ACTIVITY_CLICKED),leading:(0,a.tZ)(B.hs,{children:(0,a.tZ)(m.Z,{size:20})}),native:!0,children:(0,a.BX)(B.hs,{flex:"grow",justifyContent:"space-between",children:[s("Activity"),u>0&&(0,a.tZ)(Z.V,{className:"indicator-badge",count:u})]})}),(0,a.tZ)(w.u,{href:(0,I._P8)(),onClick:c(E.FP.USER_MENU_DISCOVER_CLICKED),leading:(0,a.tZ)(B.M5,{width:20,height:20,children:(0,a.tZ)(d.Z,{size:16,strokeWidth:2})}),native:!0,children:s("Explore")})]}),(0,a.tZ)(H,{freeSignup:null!=l&&l,pub:null!=n?n:null,user:i}),(0,a.tZ)(K,{pub:null!=n?n:null}),!i.reader_installed_at&&(0,a.tZ)(P.xw,{children:(0,a.tZ)(w.u,{href:(0,I.tSX)({utm_campaign:R.VX.appMarketing,utm_content:R.fZ.userMenuLink}),priority:"accent",native:!0,children:s("Get the app")})}),(0,a.tZ)(W,{enableCustomerServiceMode:r,disableCustomerServiceMode:o,pub:null!=n?n:null,user:i}),(0,a.tZ)(q,{pub:null!=n?n:null})]})}let j=e=>{let{user:t}=e,{iString:i}=(0,C.M1)(),n=(0,N.Lw)(t,{utm_source:D}),r="",o="";return t&&(r=(null==t?void 0:t.profile_set_up_at)&&t.name?t.name:t.email,o=(null==t?void 0:t.profile_set_up_at)?t.handle?"@".concat(t.handle):null:i("Set up your profile")),(0,a.tZ)(w.u,{href:n,onClick:()=>(0,E.j)(E.FP.USER_MENU_PROFILE_CLICKED),native:!0,children:(0,a.BX)(B.hs,{gap:12,alignItems:"center",children:[(0,a.tZ)(S.qE,{size:40,user:null!=t?t:void 0,"aria-hidden":!0}),(0,a.BX)(B.tu,{flex:"grow",children:[(0,a.tZ)(M.xv.B4,{weight:"semibold",children:r}),o&&(0,a.tZ)(M.xv.B4,{color:"secondary",children:o})]})]})})},H=e=>{let{freeSignup:t,user:i,pub:n}=e,{iString:r}=(0,C.M1)(),o=n&&(t||i&&(i.is_subscribed||i.is_free_subscribed)),l=!!(null==i?void 0:i.subdomain);return l||o?(0,a.BX)(P.xw,{children:[o&&(0,a.tZ)(w.u,{href:(0,I.n1t)("/account",{utm_source:D}),onClick:()=>(0,E.j)(E.FP.USER_MENU_MANAGE_SUBSCRIPTION_CLICKED),priority:"secondary",native:!0,children:r("Manage subscription")}),l&&i.subdomain&&(0,a.tZ)(w.u,{priority:"secondary",href:(0,I.c0Q)(i.subdomain,{params:{utm_source:R.b3.substack}}),native:!0,trailing:(0,a.tZ)(c.Z,{}),children:r("Dashboard")})]}):null},K=e=>{let{pub:t}=e,{iString:i}=(0,C.M1)();return(0,a.BX)(P.xw,{children:[(0,a.tZ)(w.u,{href:(0,I.v3t)({utm_source:D}),onClick:()=>(0,E.j)(E.FP.USER_MENU_ACCOUNT_SETTINGS_CLICKED),priority:"secondary",native:!0,children:i("Settings")}),(0,a.tZ)(w.u,{href:F,priority:"secondary",children:i("Support")}),(0,a.tZ)(w.u,{href:(0,I.ZPN)({utm_source:D,for_pub:null==t?void 0:t.subdomain}),priority:"secondary",native:!0,children:i("Sign out")})]})},W=e=>{let{disableCustomerServiceMode:t,enableCustomerServiceMode:i,pub:n,user:r}=e;return(null==r?void 0:r.is_global_admin)&&(i||t)?(0,a.BX)(P.xw,{children:[i&&(0,a.tZ)(w.u,{priority:"secondary",onClick:i,trailing:(0,a.tZ)(p.Z,{}),native:!0,children:"Enter support mode"}),t&&(0,a.tZ)(w.u,{priority:"secondary",onClick:t,trailing:(0,a.tZ)(p.Z,{}),native:!0,children:"Exit support mode"}),n&&(0,a.tZ)(w.u,{priority:"secondary",href:"".concat((0,z.SVA)({subdomain:"admin"}),"/publications/").concat(n.id),trailing:(0,a.tZ)(p.Z,{}),native:!0,children:"Open in Underground"})]}):null},q=e=>{let{pub:t}=e,{iString:i}=(0,C.M1)();return(0,a.tZ)(P.xw,{children:(0,a.tZ)(M.xv.B4,{size:12,color:"secondary",children:(0,a.BX)(B.hs,{gap:12,padding:8,className:"footer",children:[(0,a.tZ)(M.hh,{href:(0,I.cdl)({utm_source:D}),children:i("About")}),(0,a.tZ)(M.hh,{href:(0,U.RF)({pub:t,utm_source:D}),children:i("Privacy")}),(0,a.tZ)(M.hh,{href:(0,U.P8)({pub:t,utm_source:D}),children:i("Terms")}),(0,a.tZ)(M.hh,{href:(0,U.WF)({utm_source:D}),children:i("Data")})]})})})}},59480:function(e,t,i){i.d(t,{Uu:()=>s});var n=i(68833);let r=["sort"],o=["sort","selection"],a=[];function l(e,t){let i;try{i=new URL("".concat(location.protocol,"//").concat(location.host).concat(e))}catch(t){i=new URL(e)}for(let e of i.searchParams.keys())(t?o:r).includes(e)||i.searchParams.delete(e);return i.toString()}function s(e){setTimeout(()=>(function(e){var t,i;let{previous:r,url:o}=e;if("undefined"==typeof window)return;let s=l(o,!1),u=l(o,!0),{head:d}=document;null===(t=d.querySelector("link[rel=canonical]"))||void 0===t||t.setAttribute("href",s),null===(i=d.querySelector('meta[property="og:url"]'))||void 0===i||i.setAttribute("content",u),a.push(o),setTimeout(()=>{(0,n.jA)({previous:r,url:o})},100)})(e),0)}},34552:function(e,t,i){i.d(t,{Vc:()=>h});var n=i(16584),r=i(98661),o=i(30218),a=i(93666),l=i(96726),s=i(14952),u=i(60807),d=i(48980),c=i(98914),p=i(60308),_=i(26111);function h(){var e;let{showCustomerSupportModeModal:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,s.Ij)(),h=(0,u.aF)(),{canTurnOnCustomerSupportMode:m,isInCustomerSupportMode:b}={canTurnOnCustomerSupportMode:!!(null==(e=(0,u.aF)())?void 0:e.is_global_admin)&&!(null==e?void 0:e.is_admin),isInCustomerSupportMode:!!(null==e?void 0:e.is_global_admin)&&!!(null==e?void 0:e.is_admin)&&!(null==e?void 0:e.is_author)},v=(0,r.useRef)(null),f=async()=>{try{await (0,d.rd)("/api/v1/customer_support_mode",{method:"DELETE"}),document.location.href="/"}catch(e){alert((0,c.zx)(e))}},Z=async()=>{if(null==i?void 0:i.custom_domain){let e=window.location.pathname;(0,c.uX)((0,p.Q6L)(e,i),{local_navigation:!1})}else{var e;null===(e=v.current)||void 0===e||e.open()}},g=m&&(0,n.tZ)(l.h,{children:(0,n.tZ)(a.p,{className:"account-info-customer-support-mode-modal",ref:v,openByDefault:t&&m,children:(0,n.tZ)(o.Z,{redirect:(0,_.x)("redirect")||"/publish/home",onCancel:e=>{var t;return null===(t=v.current)||void 0===t?void 0:t.close(e)},requiresMfa:null==h?void 0:h.requires_global_admin_mfa_challenge})})});return{enableCustomerServiceMode:m?Z:void 0,disableCustomerServiceMode:b?f:void 0,modalElement:g}}},74583:function(e,t,i){i.d(t,{$:()=>N,f:()=>E});var n=i(7409),r=i(99282),o=i(16584),a=i(30396),l=i(94184),s=i.n(l),u=i(68494),d=i(23970),c=i(95441),p=i(36518),_=i(68833),h=i(7882),m=i(15771),b=i(19081),v=i(84747),f=i(87077),Z=i(83010),g=i(74312),C=i(57693),y=i(21694);function E(e){let{canShowAlerts:t=!1}=e,l=(0,p.lR)(),s=(0,h.ib)({pathname:"/api/v1/activity-feed-web",query:{limit:12},auto:!1});(0,a.d4)(()=>{l.activityUnreadCount>0&&(0,_.j)(_.FP.NOTIFICATIONS_UNREAD_SHOWN,{unreadCount:l.activityUnreadCount})},[l.activityUnreadCount]);let y=()=>Promise.all([i.e("3751"),i.e("2280"),i.e("5239"),i.e("7833"),i.e("3030")]).then(i.bind(i,79075)),{iString:E}=(0,c.M1)();return(0,o.BX)(Z.H,{trackingProps:{surface:"dropdown"},children:[(0,o.tZ)(v.M,{trigger:e=>(0,o.tZ)(f.u,{text:E("Activity"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:f.$$},children:(0,o.BX)(m.hU,(0,r._)((0,n._)({},e),{"aria-label":"View activity",priority:"tertiary",onMouseEnter:y,position:"relative",children:[(0,o.tZ)(u.Z,{"aria-hidden":!0,size:20}),l.activityUnreadCount>0&&(0,o.tZ)(N,{count:l.activityUnreadCount})]}))}),onOpen:()=>s.refetch(),maxHeight:"fit-content",padding:0,Theme:d.m,children:(0,o.tZ)(g.cr,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsViewer,onRequest:y,resource:s,bellCount:l.activityUnreadCount,whileLoading:(0,o.tZ)(b.hs,{width:400})})}),t&&(0,o.tZ)(C.l,{})]})}function N(e){let{count:t}=e;return(0,o.tZ)(b.hs,{className:s()(y.Z.badge,t<10&&y.Z.circle),alignItems:"center",justifyContent:"center",children:t<100?t:"99+"})}},91684:function(e,t,i){i.d(t,{b:()=>v});var n=i(7409),r=i(99282),o=i(16584),a=i(30396),l=i(7617),s=i(23970),u=i(95441),d=i(68833),c=i(80026),p=i(84747),_=i(87077),h=i(97842),m=i(74312),b=i(74583);function v(){var e,t;let{iString:i}=(0,u.M1)(),v=null!==(t=null===(e=(0,h.WG)({},{focusThrottleInterval:3e5}).data)||void 0===e?void 0:e.unreadCount)&&void 0!==t?t:0;return(0,a.d4)(()=>{(0,d.j)(d.FP.CHAT_DROPDOWN_BADGE_SHOWN,{count:v})},[v]),(0,o.tZ)(p.M,{trigger:e=>(0,o.tZ)(_.u,{text:i("Chat"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:_.$$},children:(0,o.BX)(c.hU,(0,r._)((0,n._)({},e),{"aria-label":"View chats",priority:"tertiary",onMouseEnter:f,position:"relative",children:[(0,o.tZ)(l.Z,{size:20}),v>0&&(0,o.tZ)(b.$,{count:v})]}))}),onClose:()=>{(0,d.j)(d.FP.CHAT_DROPDOWN_CLOSED)},maxHeight:"fit-content",padding:0,Theme:s.m,children:(0,o.tZ)(m.cr,{module:"./MiniInbox",onRequest:f,resolve:e=>e.MiniChatInbox,whileLoading:(0,o.tZ)(c.xu,{width:360})})})}let f=()=>Promise.all([i.e("9776"),i.e("7294"),i.e("4327"),i.e("2280"),i.e("1761"),i.e("2340"),i.e("1026"),i.e("8336"),i.e("5239"),i.e("7833"),i.e("9764"),i.e("3583"),i.e("2236"),i.e("3330")]).then(i.bind(i,90370))}}]);